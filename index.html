<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NSS Pro 3D</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&display=swap');

    body {
        margin: 0;
        background: #000;
        overflow: hidden;
        font-family: 'Oswald', sans-serif;
        touch-action: none; /* Mobilde scrollu engelle */
    }

    #game-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle at center top, #1e3c72, #2a5298, #000);
    }

    canvas {
        display: block;
        width: 100%;
        height: 100%;
    }

    /* UI KATMANI */
    #ui-layer {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #score-board {
        margin-top: 20px;
        text-align: center;
        color: white;
        text-shadow: 0 4px 10px rgba(0,0,0,0.8);
    }
    .score-txt { font-size: 40px; font-weight: 700; letter-spacing: 2px; }
    .status-txt { font-size: 14px; opacity: 0.8; font-weight: 500; }

    #controls-hint {
        text-align: center;
        margin-bottom: 50px;
        color: rgba(255,255,255,0.6);
        font-size: 14px;
        text-transform: uppercase;
        animation: fade 2s infinite;
    }

    @keyframes fade { 0%,100%{opacity:0.4} 50%{opacity:1} }

    /* Gol Efekti YazÄ±sÄ± */
    #goal-overlay {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%) scale(0);
        color: #f1c40f;
        font-size: 80px;
        font-weight: 900;
        text-shadow: 0 0 20px rgba(243, 156, 18, 0.8);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
        z-index: 10;
    }

</style>
</head>
<body>

<div id="game-container">
    <canvas id="canvas"></canvas>
    
    <div id="ui-layer">
        <div id="score-board">
            <div class="score-txt"><span id="s-home">0</span> - <span id="s-away">0</span></div>
            <div class="status-txt" id="status-msg">Åžut Ã§ekmek iÃ§in kaydÄ±r</div>
        </div>
        <div id="controls-hint">
            <p>ðŸ‘† ParmaÄŸÄ±nÄ± KaydÄ±rarak Åžut Ã‡ek</p>
        </div>
    </div>

    <div id="goal-overlay">GOL!</div>
</div>

<script>
/**
 * NSS PRO 3D ENGINE
 * Ã–zellikler: Pseudo-3D Projection, Swipe Fizikleri, ParÃ§acÄ±k Sistemi
 */

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// --- EKRAN AYARLARI ---
let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- 3D AYARLARI ---
const FOV = 350; // Field of View (Kamera aÃ§Ä±sÄ±)
const CAM_Y = -120; // Kamera yÃ¼ksekliÄŸi (daha negatif = daha yukarÄ±dan)
const CAM_Z = -400; // Kamera uzaklÄ±ÄŸÄ±
const GROUND_Y = 150; // Zemin seviyesi

// --- OYUN DEÄžÄ°ÅžKENLERÄ° ---
let score = { h: 0, a: 0 };
let gameState = 'AIM'; // AIM, SHOT, CELEBRATE, RESET
let particles = [];

// --- FÄ°ZÄ°K NESNELERÄ° ---
let ball = { x: 0, y: GROUND_Y, z: 0, vx: 0, vy: 0, vz: 0, r: 10, spin: 0 };
let goal = { w: 220, h: 100, z: 600 }; // Kale boyutlarÄ± ve uzaklÄ±ÄŸÄ±
let keeper = { x: 0, y: GROUND_Y, w: 40, h: 90, diveTarget: 0, state: 'IDLE' };
let netNodes = []; // AÄŸ simÃ¼lasyonu iÃ§in noktalar

// --- KONTROL (SWIPE) ---
let touchStart = { x: 0, y: 0, time: 0 };
let isTouching = false;

// --- PROJECTION FONKSÄ°YONU (3D -> 2D) ---
function project(x, y, z) {
    // Kameraya gÃ¶re gÃ¶receli konum
    const scale = FOV / (FOV + z + (-CAM_Z));
    const x2d = (x * scale) + W / 2;
    const y2d = ((y + CAM_Y) * scale) + H / 2;
    return { x: x2d, y: y2d, s: scale };
}

// --- OYUN DÃ–NGÃœSÃœ ---
function loop() {
    // 1. Fizik HesaplamalarÄ±
    updatePhysics();
    
    // 2. Ã‡izim
    drawBackground();
    drawGround();
    drawGoalBack();
    drawNet();
    drawGoalFront();
    drawKeeper();
    drawBall();
    drawParticles();

    requestAnimationFrame(loop);
}

// --- FÄ°ZÄ°K MOTORU ---
function updatePhysics() {
    if (gameState === 'SHOT') {
        // HÄ±z uygula
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.z += ball.vz;
        
        // YerÃ§ekimi
        ball.vy += 0.5; 
        
        // Hava sÃ¼rtÃ¼nmesi (top yavaÅŸlar)
        ball.vz *= 0.995; 

        // Falso (Spin) etkisi - Magnus Effect (BasitleÅŸtirilmiÅŸ)
        ball.x += ball.spin;

        // YERLE ETKÄ°LEÅžÄ°M (ZÄ±plama)
        if (ball.y > GROUND_Y) {
            ball.y = GROUND_Y;
            ball.vy *= -0.6; // Enerji kaybÄ±
            ball.vx *= 0.8;
            // EÄŸer Ã§ok yavaÅŸladÄ±ysa durdur
            if(Math.abs(ball.vy) < 1 && Math.abs(ball.vz) < 2) {
                // Åžut bitti
                setTimeout(resetRound, 1000);
            }
        }

        // KALE KONTROLÃœ
        // Kale dÃ¼zlemine ulaÅŸtÄ± mÄ±?
        if (ball.z > goal.z && ball.z < goal.z + 50) {
            // Kale sÄ±nÄ±rlarÄ± iÃ§inde mi?
            if (ball.x > -goal.w/2 && ball.x < goal.w/2 && ball.y < GROUND_Y && ball.y > GROUND_Y - goal.h) {
                // Kaleci kurtardÄ± mÄ±?
                let kDist = Math.hypot(ball.x - keeper.x, ball.y - (keeper.y - 40));
                
                if (kDist < 40) {
                    // KurtarÄ±ÅŸ
                    ball.vz *= -0.5; // Geri seker
                    ball.vx += (Math.random()-0.5) * 10;
                    showToast("KALECÄ° KURTARDI!");
                    gameState = 'RESET';
                    setTimeout(resetRound, 2000);
                } else {
                    // GOL!
                    if(gameState !== 'CELEBRATE') {
                        goalScored();
                    }
                }
            } else if (ball.x < -goal.w/2 || ball.x > goal.w/2 || ball.y < GROUND_Y - goal.h) {
                // DÄ±ÅŸarÄ±
                 if (ball.z > goal.z + 10) {
                    showToast("AUT!");
                    setTimeout(resetRound, 1500);
                 }
            }
        }
        
        // Ã‡ok uzaÄŸa gittiyse
        if(ball.z > 1000) resetRound();
    }

    // Kaleci Yapay ZekasÄ±
    if (gameState === 'SHOT' && ball.z > 100) {
        // Topa doÄŸru hareket et (Gecikmeli)
        let targetX = ball.x;
        // Ä°nsan hatasÄ± ekle
        keeper.x += (targetX - keeper.x) * 0.08;
        
        // ZÄ±plama (Top yÃ¼ksekse)
        if (ball.y < GROUND_Y - 40 && keeper.y === GROUND_Y) {
            keeper.y -= 5; // Basit zÄ±plama
        }
    } else {
        // Kaleci eski yerine dÃ¶n
        keeper.x += (0 - keeper.x) * 0.05;
        keeper.y = GROUND_Y;
    }
}

// --- GÃ–RSELLEÅžTÄ°RME (Ã‡Ä°ZÄ°M) ---

function drawBackground() {
    // GÃ¶kyÃ¼zÃ¼ Gradient
    let grd = ctx.createLinearGradient(0, 0, 0, H);
    grd.addColorStop(0, "#1e3c72");
    grd.addColorStop(0.5, "#2a5298");
    grd.addColorStop(1, "#111");
    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, W, H);
}

function drawGround() {
    // Zemin Gradient (Ufuk Ã§izgisi efekti)
    let p1 = project(-1000, GROUND_Y, 0);
    let p2 = project(1000, GROUND_Y, 2000); // Sonsuzluk
    
    // Ã‡im AlanÄ±
    ctx.fillStyle = "#2ecc71";
    // 3D DÃ¼zlem Ã§izimi (Basit Trapezoid)
    let tl = project(-800, GROUND_Y, 2000);
    let tr = project(800, GROUND_Y, 2000);
    let bl = project(-1500, GROUND_Y, -200);
    let br = project(1500, GROUND_Y, -200);

    ctx.beginPath();
    ctx.moveTo(tl.x, tl.y);
    ctx.lineTo(tr.x, tr.y);
    ctx.lineTo(br.x, br.y);
    ctx.lineTo(bl.x, bl.y);
    ctx.fill();

    // Ã‡im Ã‡izgileri (Perspektif iÃ§in)
    ctx.strokeStyle = "rgba(0,0,0,0.1)";
    ctx.lineWidth = 2;
    for (let z = 0; z < 2000; z += 100) {
        let l1 = project(-800, GROUND_Y, z);
        let l2 = project(800, GROUND_Y, z);
        ctx.beginPath(); ctx.moveTo(l1.x, l1.y); ctx.lineTo(l2.x, l2.y); ctx.stroke();
    }
}

function drawGoalBack() {
    // Kale arka direkleri
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#bdc3c7";
    
    let depth = 80;
    let tl = project(-goal.w/2, GROUND_Y - goal.h, goal.z);
    let tr = project(goal.w/2, GROUND_Y - goal.h, goal.z);
    let bl = project(-goal.w/2, GROUND_Y, goal.z);
    let br = project(goal.w/2, GROUND_Y, goal.z);

    let tlb = project(-goal.w/2, GROUND_Y - goal.h, goal.z + depth);
    let trb = project(goal.w/2, GROUND_Y - goal.h, goal.z + depth);
    let blb = project(-goal.w/2, GROUND_Y, goal.z + depth);
    let brb = project(goal.w/2, GROUND_Y, goal.z + depth);
    
    ctx.beginPath();
    // Arka Ã§erÃ§eve
    ctx.moveTo(tlb.x, tlb.y); ctx.lineTo(trb.x, trb.y);
    ctx.lineTo(brb.x, brb.y); ctx.moveTo(tlb.x, tlb.y); ctx.lineTo(blb.x, blb.y);
    // BaÄŸlantÄ±lar
    ctx.moveTo(tl.x, tl.y); ctx.lineTo(tlb.x, tlb.y);
    ctx.moveTo(tr.x, tr.y); ctx.lineTo(trb.x, trb.y);
    ctx.moveTo(bl.x, bl.y); ctx.lineTo(blb.x, blb.y);
    ctx.moveTo(br.x, br.y); ctx.lineTo(brb.x, brb.y);
    ctx.stroke();
}

function drawNet() {
    // AÄŸ deseni
    ctx.strokeStyle = "rgba(255,255,255,0.15)";
    ctx.lineWidth = 1;
    let depth = 80;
    
    // Dikey Ã§izgiler
    for(let i=0; i<=10; i++) {
        let x = -goal.w/2 + (goal.w * (i/10));
        let pTop = project(x, GROUND_Y - goal.h, goal.z);
        let pBackTop = project(x, GROUND_Y - goal.h, goal.z + depth);
        let pBackBot = project(x, GROUND_Y, goal.z + depth);
        
        ctx.beginPath();
        ctx.moveTo(pTop.x, pTop.y); ctx.lineTo(pBackTop.x, pBackTop.y); ctx.lineTo(pBackBot.x, pBackBot.y);
        ctx.stroke();
    }
    // Yatay Ã§izgiler
    for(let i=0; i<=5; i++) {
        let y = (GROUND_Y - goal.h) + (goal.h * (i/5));
        let pL = project(-goal.w/2, y, goal.z + depth);
        let pR = project(goal.w/2, y, goal.z + depth);
        ctx.beginPath(); ctx.moveTo(pL.x, pL.y); ctx.lineTo(pR.x, pR.y); ctx.stroke();
    }
}

function drawGoalFront() {
    // Ã–n direkler (Daha kalÄ±n)
    ctx.lineWidth = 8;
    ctx.strokeStyle = "#ecf0f1";
    
    let tl = project(-goal.w/2, GROUND_Y - goal.h, goal.z);
    let tr = project(goal.w/2, GROUND_Y - goal.h, goal.z);
    let bl = project(-goal.w/2, GROUND_Y, goal.z);
    let br = project(goal.w/2, GROUND_Y, goal.z);

    ctx.beginPath();
    ctx.moveTo(bl.x, bl.y); ctx.lineTo(tl.x, tl.y); // Sol
    ctx.lineTo(tr.x, tr.y); // Ãœst
    ctx.lineTo(br.x, br.y); // SaÄŸ
    ctx.stroke();
}

function drawKeeper() {
    let p = project(keeper.x, keeper.y, goal.z - 20); // Kaleci Ã§izgiden biraz Ã¶nde
    let h = 90 * p.s;
    let w = 40 * p.s;

    // GÃ¶lge
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.beginPath(); ctx.ellipse(p.x, p.y, w/1.5, w/4, 0, 0, Math.PI*2); ctx.fill();

    // Kaleci (Basit Åžekil)
    ctx.fillStyle = "#e74c3c"; // Forma
    ctx.fillRect(p.x - w/2, p.y - h, w, h/2); // GÃ¶vde
    ctx.fillStyle = "#2c3e50"; // Åžort
    ctx.fillRect(p.x - w/2, p.y - h/2, w, h/4);
    
    // Kafa
    ctx.fillStyle = "#f1c40f";
    ctx.beginPath(); ctx.arc(p.x, p.y - h - (10*p.s), 12*p.s, 0, Math.PI*2); ctx.fill();
    
    // Eldivenler
    ctx.fillStyle = "white";
    // KollarÄ±n durumu (Atlama vs)
    if(Math.abs(keeper.x - ball.x) > 20) {
        // UzatmÄ±ÅŸ el
        ctx.fillRect(p.x - w, p.y - h/1.5, 10*p.s, 10*p.s);
        ctx.fillRect(p.x + w - 10*p.s, p.y - h/1.5, 10*p.s, 10*p.s);
    }
}

function drawBall() {
    let p = project(ball.x, ball.y, ball.z);
    let size = ball.r * p.s;

    // GÃ¶lge
    if(ball.y < GROUND_Y) {
        let shadowP = project(ball.x, GROUND_Y, ball.z);
        let shadowSize = size * (1 - (GROUND_Y - ball.y)/200); // YÃ¼kseldikÃ§e kÃ¼Ã§Ã¼lÃ¼r
        if(shadowSize > 0) {
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.beginPath();
            ctx.ellipse(shadowP.x, shadowP.y, shadowSize, shadowSize/2, 0, 0, Math.PI*2);
            ctx.fill();
        }
    }

    // Top
    let grad = ctx.createRadialGradient(p.x - size/3, p.y - size/3, size/10, p.x, p.y, size);
    grad.addColorStop(0, "#fff");
    grad.addColorStop(1, "#bdc3c7");
    
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
    ctx.fill();

    // Top DetayÄ± (DÃ¶nÃ¼ÅŸÃ¼ hissettirmek iÃ§in)
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(p.x, p.y, size/1.5, 0 + ball.z/50, 2 + ball.z/50); // DÃ¶nÃ¼ÅŸ simÃ¼lasyonu
    ctx.stroke();
}

function drawParticles() {
    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.2; // Gravity
        p.life -= 0.02;

        if(p.life > 0) {
            let proj = project(p.x, p.y, goal.z);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.fillRect(proj.x, proj.y, 5 * proj.s, 5 * proj.s);
            ctx.globalAlpha = 1;
        } else {
            particles.splice(i, 1);
            i--;
        }
    }
}

// --- GOL MANTIÄžI ---
function goalScored() {
    gameState = 'CELEBRATE';
    score.h++;
    document.getElementById('s-home').innerText = score.h;
    
    // GOL Overlay Efekti
    let overlay = document.getElementById('goal-overlay');
    overlay.style.transform = "translate(-50%, -50%) scale(1)";
    
    // Konfeti Patlat
    for(let i=0; i<50; i++) {
        particles.push({
            x: (Math.random() - 0.5) * goal.w, // Kalenin iÃ§inde rastgele
            y: GROUND_Y - goal.h/2,
            vx: (Math.random() - 0.5) * 10,
            vy: -Math.random() * 15,
            color: `hsl(${Math.random()*360}, 100%, 50%)`,
            life: 1.0
        });
    }

    setTimeout(() => {
        overlay.style.transform = "translate(-50%, -50%) scale(0)";
        resetRound();
    }, 2500);
}

function showToast(msg) {
    document.getElementById('status-msg').innerText = msg;
    document.getElementById('status-msg').style.color = "#f1c40f";
    setTimeout(() => {
        document.getElementById('status-msg').innerText = "Åžut Ã§ekmek iÃ§in kaydÄ±r";
        document.getElementById('status-msg').style.color = "rgba(255,255,255,0.8)";
    }, 2000);
}

function resetRound() {
    gameState = 'AIM';
    ball.x = 0;
    ball.y = GROUND_Y;
    ball.z = 0;
    ball.vx = 0; ball.vy = 0; ball.vz = 0; ball.spin = 0;
    keeper.x = 0;
}

// --- DOKUNMATÄ°K / MOUSE KONTROLLERÄ° ---

document.addEventListener('touchstart', handleStart, {passive: false});
document.addEventListener('touchend', handleEnd, {passive: false});
document.addEventListener('mousedown', handleStart);
document.addEventListener('mouseup', handleEnd);

function handleStart(e) {
    if(gameState !== 'AIM') return;
    e.preventDefault(); // Scroll engelle
    
    let x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
    let y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
    
    touchStart.x = x;
    touchStart.y = y;
    touchStart.time = Date.now();
    isTouching = true;
}

function handleEnd(e) {
    if(!isTouching || gameState !== 'AIM') return;
    isTouching = false;
    
    let x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
    let y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
    let time = Date.now() - touchStart.time;

    // Swipe VektÃ¶rÃ¼
    let dx = x - touchStart.x;
    let dy = y - touchStart.y;
    
    // HÄ±z Hesaplama (Mesafe / Zaman)
    let dist = Math.hypot(dx, dy);
    let speed = Math.min(dist / time * 20, 45); // Max hÄ±z limiti
    
    if (dist < 20) return; // Ã‡ok kÄ±sa dokunuÅŸlarÄ± yoksay

    // AÃ§Ä± Hesaplama
    // dx: SaÄŸa sola gidiÅŸ
    // dy: YukarÄ± aÅŸaÄŸÄ± (Negatif yukarÄ±dÄ±r)

    ball.vx = dx * 0.15; // Yatay hÄ±z
    ball.vy = dy * 0.25; // Dikey hÄ±z (Havalanma)
    ball.vz = speed * 1.5; // Ä°leri hÄ±z
    
    // Falso Hesaplama (Curve)
    // EÄŸer parmak dÃ¼mdÃ¼z gitmediyse falso ver (Basit mantÄ±k: X deÄŸiÅŸimi)
    ball.spin = -(dx * 0.005); 

    gameState = 'SHOT';
    document.getElementById('controls-hint').style.display = 'none';
}

// Oyunu BaÅŸlat
loop();

</script>
</body>
</html>
kem dÃ¼dÃ¼ÄŸÃ¼nÃ¼ Ã§aldÄ±!<br>";
    updateMatchScore();
    
    match.interval = setInterval(matchLoop, 500); // HÄ±zlÄ± simÃ¼lasyon
}

function matchLoop() {
    match.time += 2;
    updateMatchScore();

    // Olay Ãœretici
    let r = Math.random();
    
    // 1. YazÄ±sal Olaylar
    if(r < 0.2) logMatch("Orta sahada top Ã§eviriyoruz.");
    else if(r < 0.3) logMatch("Rakip baskÄ±yÄ± arttÄ±rdÄ±.");
    else if(r < 0.4 && match.time > 10) {
        // RAKÄ°P GOL
        if(Math.random() > 0.6) {
            match.scoreA++;
            logMatch("GOL! Rakip affetmedi.", "red");
        } else {
            logMatch("Kalecimiz harika kurtardÄ±!");
        }
    }
    
    // 2. OYUNCU FIRSATI (AKSÄ°YON)
    else if (r > 0.85) {
        clearInterval(match.interval);
        logMatch(">>> ARA PASINI ALDIN! VUR ÅžUTUNU!", "gold");
        setTimeout(openShootingGame, 1000);
    }

    if(match.time >= 90) endMatch();
}

function updateMatchScore() {
    document.getElementById('match-score').innerText = `${match.scoreH} - ${match.scoreA}`;
    document.getElementById('match-timer').innerText = match.time + ":00";
}

function logMatch(msg, color="white") {
    let div = document.createElement('div');
    div.innerText = `${match.time}' ${msg}`;
    div.style.color = color === "red" ? "#e74c3c" : (color === "gold" ? "#f1c40f" : "#ccc");
    div.style.borderBottom = "1px solid #333";
    div.style.padding = "2px 0";
    let box = document.getElementById('news-ticker');
    box.prepend(div);
}

// --- ÅžUT MEKANÄ°ÄžÄ° (MODERN CANVAS) ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let game = { phase: 'IDLE', ball: {}, arrow: {} };
let animId;

function openShootingGame() {
    document.getElementById('game-layer').style.display = 'flex';
    resizeCanvas();
    resetShot();
    game.phase = 'AIM_DIR'; // 1. AÅŸama: YÃ¶n
    document.getElementById('instruction-text').innerText = "YÃ–N Ä°Ã‡Ä°N DOKUN";
    loop();
}

function resetShot() {
    game.ball = { x: canvas.width/2, y: canvas.height - 100, z: 1, dx:0, dy:0, dz:0 };
    game.arrow = { angle: -Math.PI/2, swing: 0.05, height: 0 }; 
    game.keeper = { x: canvas.width/2, dir: 1 };
}

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

// OYUN DÃ–NGÃœSÃœ
function loop() {
    updatePhysics();
    drawScene();
    if(game.phase !== 'ENDED') animId = requestAnimationFrame(loop);
}

function updatePhysics() {
    // Kaleci Hareketi
    game.keeper.x += 2 * game.keeper.dir;
    if(game.keeper.x > canvas.width/2 + 100 || game.keeper.x < canvas.width/2 - 100) game.keeper.dir *= -1;

    // 1. YÃ¶n SeÃ§imi (Ok sallanÄ±r)
    if(game.phase === 'AIM_DIR') {
        game.arrow.angle += game.arrow.swing;
        if(game.arrow.angle < -Math.PI + 0.5 || game.arrow.angle > -0.5) game.arrow.swing *= -1;
    }
    // 2. YÃ¼kseklik/GÃ¼Ã§ SeÃ§imi (Bar yukarÄ± aÅŸaÄŸÄ± gider - simÃ¼le ediyoruz)
    else if (game.phase === 'AIM_HEIGHT') {
        // Burada basitlik adÄ±na otomatik geÃ§iyoruz ama gÃ¶rsel olarak ok rengi deÄŸiÅŸebilir
    }
    // 3. Åžut Hareketi
    else if (game.phase === 'MOVING') {
        game.ball.x += game.ball.dx;
        game.ball.y += game.ball.dy;
        game.ball.z -= 0.015; // Top uzaklaÅŸÄ±r (Scale kÃ¼Ã§Ã¼lÃ¼r)
        
        // YerÃ§ekimi efekti (YÃ¼kseklik)
        game.ball.dy += 0.1; 

        // Gol KontrolÃ¼ (Derinlik Z < 0.5 olduÄŸunda kale Ã§izgisine gelmiÅŸtir)
        if(game.ball.z < 0.4) {
            checkGoal();
        }
        
        // DÄ±ÅŸarÄ± Ã§Ä±kma
        if(game.ball.x < 0 || game.ball.x > canvas.width || game.ball.y > canvas.height) {
            endShot(false, "DIÅžARI!");
        }
    }
}

function checkGoal() {
    let goalW = 200; // Kale geniÅŸliÄŸi
    let goalH = 100; // Kale yÃ¼ksekliÄŸi
    let goalX = canvas.width/2 - 100;
    let goalY = 150; // Kale Ã¼st direk Y pozisyonu (yaklaÅŸÄ±k)

    // Basit Ã§arpÄ±ÅŸma mantÄ±ÄŸÄ±
    let hitX = game.ball.x > goalX && game.ball.x < goalX + goalW;
    let hitY = game.ball.y > goalY && game.ball.y < goalY + goalH;
    
    // Kaleci kurtarÄ±ÅŸÄ±
    let saved = Math.abs(game.ball.x - game.keeper.x) < 30;

    if(hitX && hitY && !saved) {
        endShot(true, "GOOOOL!!!");
    } else if (saved && hitX && hitY) {
        endShot(false, "KALECÄ° KURTARDI!");
    } else {
        endShot(false, "AUT!");
    }
}

function endShot(isGoal, msg) {
    game.phase = 'ENDED';
    cancelAnimationFrame(animId);
    
    // Canvas Ã¼zerine yazÄ± yaz
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, canvas.height/2 - 50, canvas.width, 100);
    ctx.fillStyle = isGoal ? "#2ecc71" : "#e74c3c";
    ctx.font = "bold 40px Roboto";
    ctx.textAlign = "center";
    ctx.fillText(msg, canvas.width/2, canvas.height/2 + 15);

    setTimeout(() => {
        document.getElementById('game-layer').style.display = 'none';
        
        if(isGoal) {
            match.scoreH++;
            state.rating = Math.min(10, state.rating + 0.3);
            state.money += 20; // Gol primi
            state.relationships.fans += 2;
            logMatch("MÃœKEMMEL GOL! " + msg, "gold");
        } else {
            state.rating = Math.max(1, state.rating - 0.1);
            logMatch("FÄ±rsat kaÃ§tÄ±: " + msg, "red");
        }
        
        state.energy -= 5;
        updateHUD();
        updateMatchScore();
        match.interval = setInterval(matchLoop, 500); // MaÃ§Ä± sÃ¼rdÃ¼r
    }, 1500);
}

// Ã‡Ä°ZÄ°M FONKSÄ°YONLARI (GÃ¶rsellik)
function drawScene() {
    ctx.clearRect(0,0,canvas.width, canvas.height);

    // 1. KALE (Perspektif)
    let gw = 200, gh = 120, gx = canvas.width/2 - 100, gy = 150;
    
    // Arka direkler (daha kÃ¼Ã§Ã¼k - derinlik hissi)
    ctx.strokeStyle = "rgba(255,255,255,0.6)";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(gx + 20, gy + 20); ctx.lineTo(gx + gw - 20, gy + 20); // Ãœst arka
    ctx.lineTo(gx + gw - 20, gy + gh); // SaÄŸ arka
    ctx.moveTo(gx + 20, gy + gh); ctx.lineTo(gx + 20, gy + 20); // Sol arka
    ctx.stroke();

    // Ã–n direkler (daha bÃ¼yÃ¼k)
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(gx, gy + gh + 20); ctx.lineTo(gx, gy); // Sol Direk
    ctx.lineTo(gx + gw, gy); // Ãœst Direk
    ctx.lineTo(gx + gw, gy + gh + 20); // SaÄŸ Direk
    ctx.stroke();

    // AÄŸlar
    ctx.fillStyle = "rgba(255,255,255,0.1)";
    ctx.fillRect(gx, gy, gw, gh + 20);

    // 2. KALECÄ° (VektÃ¶rel Modern)
    let kx = game.keeper.x;
    let ky = gy + gh - 10;
    // Kaleci gÃ¶lge
    ctx.fillStyle = "rgba(0,0,0,0.3)";
    ctx.beginPath(); ctx.ellipse(kx, ky+35, 20, 5, 0, 0, Math.PI*2); ctx.fill();
    // Kaleci vÃ¼cut
    ctx.fillStyle = "#e74c3c";
    ctx.beginPath(); ctx.arc(kx, ky, 15, 0, Math.PI*2); ctx.fill(); // Kafa
    ctx.fillRect(kx-12, ky+15, 24, 30); // GÃ¶vde
    
    // 3. OK (Aiming)
    if(game.phase === 'AIM_DIR') {
        ctx.save();
        ctx.translate(game.ball.x, game.ball.y);
        ctx.rotate(game.arrow.angle);
        
        // Modern Ok (Gradient)
        let grad = ctx.createLinearGradient(0,0,150,0);
        grad.addColorStop(0, "rgba(241, 196, 15, 0.8)");
        grad.addColorStop(1, "rgba(241, 196, 15, 0)");
        
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.moveTo(0, -5); ctx.lineTo(150, -20); ctx.lineTo(150, 20); ctx.lineTo(0, 5);
        ctx.fill();
        ctx.restore();
    }

    // 4. TOP (3D GÃ¶rÃ¼nÃ¼mlÃ¼)
    let scale = game.ball.z;
    let r = 12 * scale;
    
    // Top GÃ¶lgesi (Yerden yÃ¼ksekliÄŸe gÃ¶re ÅŸeffaflaÅŸÄ±r)
    ctx.fillStyle = `rgba(0,0,0,${0.4 * scale})`;
    ctx.beginPath();
    ctx.ellipse(game.ball.x, game.ball.y + (20/scale), r, r/2, 0, 0, Math.PI*2);
    ctx.fill();

    // Topun kendisi
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.arc(game.ball.x, game.ball.y, r, 0, Math.PI*2); ctx.fill();
    // Top Deseni (Hexagon effect)
    ctx.strokeStyle = "#333"; ctx.lineWidth = 1 * scale;
    ctx.beginPath(); 
    ctx.moveTo(game.ball.x - r/2, game.ball.y - r/2); 
    ctx.lineTo(game.ball.x + r/2, game.ball.y + r/2);
    ctx.stroke();
}

// Ä°NPUT YÃ–NETÄ°MÄ°
document.getElementById('game-layer').addEventListener('mousedown', handleInput);
document.getElementById('game-layer').addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); });

function handleInput() {
    if(game.phase === 'AIM_DIR') {
        game.phase = 'MOVING'; // Direkt ÅŸuta geÃ§iyoruz (Basit modern hissi iÃ§in)
        // YÃ¼kseklik rastgele ama skill'e baÄŸlÄ± biraz
        let power = 12 * state.bootsMultiplier;
        
        game.ball.dx = Math.cos(game.arrow.angle) * power;
        game.ball.dy = Math.sin(game.arrow.angle) * power; 
        
        // Falso efekti (Skill ne kadar yÃ¼ksekse o kadar iyi gider)
        game.ball.dy -= (state.skill / 50); 
        
        document.getElementById('instruction-text').innerText = "";
    }
}


// --- DÄ°ÄžER FONKSÄ°YONLAR ---

function endMatch() {
    clearInterval(match.interval);
    state.week++;
    state.energy -= 10;
    
    // Lig Tablosu SimÃ¼lasyonu
    state.league[0].p += match.scoreH > match.scoreA ? 3 : (match.scoreH == match.scoreA ? 1 : 0);
    // DiÄŸer takÄ±mlar rastgele
    for(let i=1; i<state.league.length; i++) {
        state.league[i].p += Math.floor(Math.random() * 3); // 0, 1 veya 2 (Basit)
    }
    // SÄ±rala
    state.league.sort((a,b) => b.p - a.p);
    renderLeague();

    // Ä°liÅŸki GÃ¼ncellemeleri
    let msg = match.scoreH > match.scoreA ? "KazandÄ±k! TakÄ±m mutlu." : "KÃ¶tÃ¼ sonuÃ§...";
    if(match.scoreH > match.scoreA) state.relationships.boss += 5;
    else state.relationships.boss -= 5;

    alert(`MAÃ‡ SONUCU: ${match.scoreH} - ${match.scoreA}\n${msg}`);
    
    switchScreen('screen-home');
    updateHUD();
}

function renderLeague() {
    let html = "";
    state.league.forEach((t, i) => {
        let style = t.name === "BÄ°ZÄ°M TAKIM" ? "color:var(--accent); font-weight:bold;" : "";
        html += `<div class="table-row" style="${style}">
            <span>${i+1}. ${t.name}</span>
            <span>${t.p} P</span>
        </div>`;
    });
    document.getElementById('league-table').innerHTML = html;
}

function trainPlayer() {
    if(state.energy >= 15) {
        state.energy -= 15;
        state.skill++;
        state.relationships.boss += 2; // Hoca Ã§alÄ±ÅŸanÄ± sever
        alert("Antrenman bitti! Åžut yeteneÄŸin arttÄ±.");
        updateHUD();
    } else {
        alert("Ã‡ok yorgunsun!");
    }
}

function renderShop() {
    let html = "";
    shopItems.forEach(item => {
        // Envanterde var mÄ±?
        let owned = state.inventory.includes(item.id);
        let btnText = owned ? "SATIN ALINDI" : `SATIN AL ($${item.cost})`;
        let btnClass = owned ? "background:#555;" : "background:var(--primary);";
        let onclick = owned ? "" : `buyItem('${item.id}')`;

        html += `
        <div style="background:#333; padding:10px; margin-bottom:10px; border-radius:5px; display:flex; justify-content:space-between; align-items:center;">
            <div style="font-size:24px;">${item.icon}</div>
            <div style="flex:1; margin-left:10px;">
                <div style="font-weight:bold; color:var(--accent)">${item.name}</div>
                <div style="font-size:10px; opacity:0.7">${item.id === 'nrg' ? '+Enerji' : 'Prestij/Yetenek'}</div>
            </div>
            <button style="border:none; padding:8px; color:white; border-radius:4px; ${btnClass}" onclick="${onclick}">${btnText}</button>
        </div>`;
    });
    document.getElementById('shop-items').innerHTML = html;
}

window.buyItem = function(id) {
    let item = shopItems.find(i => i.id === id);
    if(state.money >= item.cost) {
        state.money -= item.cost;
        
        if(item.effect === 'energy') {
            state.energy = 100;
        } else if (item.effect === 'boots') {
            state.bootsMultiplier = 1.5;
            state.inventory.push(id);
        } else if (item.effect === 'star') {
            state.rating += item.val;
            state.inventory.push(id);
        } else if (item.effect === 'rel') {
            state.relationships[item.target] += item.val;
            if(item.id !== 'gift') state.inventory.push(id); // Hediyeler kalÄ±cÄ± deÄŸil
        }
        
        alert(item.name + " satÄ±n alÄ±ndÄ±!");
        updateHUD();
        renderShop();
    } else {
        alert("Yetersiz Bakiye!");
    }
}

</script>
</body>
</html>
