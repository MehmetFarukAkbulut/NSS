<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NSS Web Clone (Full)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@700&display=swap" rel="stylesheet">
<style>
    :root {
        --green: #27ae60;
        --dark-green: #145a32;
        --red: #c0392b;
        --yellow: #f1c40f;
        --dark: #2c3e50;
        --light: #ecf0f1;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0;
        background-color: #202020;
        font-family: 'Press Start 2P', cursive; /* Retro Font */
        color: white;
        overflow: hidden;
        touch-action: none;
    }

    #app-container {
        width: 100%;
        height: 100vh;
        max-width: 500px; /* Tablet/Mobil boyutu sƒ±nƒ±rƒ± */
        margin: 0 auto;
        background: #1a1a1a;
        position: relative;
        display: flex;
        flex-direction: column;
        border-left: 2px solid #333;
        border-right: 2px solid #333;
    }

    /* --- √úST PANEL (HUD) --- */
    #hud {
        background: #111;
        padding: 10px;
        border-bottom: 2px solid white;
        display: flex;
        justify-content: space-between;
        font-size: 10px;
    }
    .hud-box { display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .bar-cont { width: 60px; height: 10px; background: #333; border: 1px solid white; }
    .bar-fill { height: 100%; width: 100%; transition: width 0.3s; }
    #bar-nrg { background: #e74c3c; } /* Kƒ±rmƒ±zƒ± enerji barƒ± NSS stili */
    #val-money { color: var(--yellow); }

    /* --- EKRANLAR GENEL --- */
    .screen {
        flex: 1;
        display: none;
        flex-direction: column;
        padding: 15px;
        overflow-y: auto;
    }
    .active { display: flex; }

    h1 { color: var(--yellow); font-size: 18px; text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 0 #000; }
    
    /* BUTONLAR */
    .nss-btn {
        background: var(--red);
        border: 2px solid white;
        color: white;
        padding: 15px;
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        margin-bottom: 15px;
        cursor: pointer;
        box-shadow: 4px 4px 0 #550000;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .nss-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 #550000; }
    .btn-green { background: var(--green); box-shadow: 4px 4px 0 var(--dark-green); }
    .btn-green:active { box-shadow: 2px 2px 0 var(--dark-green); }

    /* --- MEN√ú (KARƒ∞YER) --- */
    .rel-box { background: #333; padding: 10px; margin-bottom: 15px; border: 1px solid #555; }
    .rel-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 8px; }
    .rel-name { width: 70px; }
    .rel-track { flex: 1; height: 6px; background: #000; }
    .rel-val { height: 100%; background: var(--green); }

    /* --- MARKET --- */
    .item-row { 
        background: #222; border: 1px solid #444; padding: 10px; margin-bottom: 10px; 
        display: flex; justify-content: space-between; align-items: center; 
    }

    /* --- MA√á MOTORU (TEXT) --- */
    #match-log {
        flex: 1;
        background: rgba(0,0,0,0.3);
        border: 2px solid #555;
        padding: 10px;
        font-family: 'Roboto', sans-serif; /* Okunabilirlik i√ßin */
        font-size: 14px;
        line-height: 1.5;
        overflow-y: auto;
        margin-bottom: 10px;
    }
    .log-event { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
    .log-goal { color: var(--green); font-weight: bold; }
    .log-danger { color: var(--red); }
    
    #scoreboard {
        background: black; padding: 15px; text-align: center; border: 2px solid white; margin-bottom: 10px;
        font-size: 20px; color: var(--yellow);
    }

    /* --- 3D ≈ûUT EKRANI (CANVAS) --- */
    #game-layer {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 999;
        display: none;
        flex-direction: column;
    }
    canvas { width: 100%; height: 100%; background: radial-gradient(#2E8B57, #113322); cursor: crosshair; }
    
    #shoot-msg {
        position: absolute; bottom: 50px; width: 100%; text-align: center;
        color: white; font-size: 14px; animation: blink 1s infinite; pointer-events: none;
    }
    @keyframes blink { 50% { opacity: 0.5; } }

</style>
</head>
<body>

<div id="app-container">
    <div id="hud">
        <div class="hud-box">
            <span>ENERJƒ∞</span>
            <div class="bar-cont"><div id="bar-nrg" class="bar-fill" style="width: 100%;"></div></div>
        </div>
        <div class="hud-box">
            <span>YILDIZ</span>
            <span style="color:yellow">‚òÖ <span id="val-star">1.0</span></span>
        </div>
        <div class="hud-box">
            <span>PARA</span>
            <span id="val-money">$50</span>
        </div>
    </div>

    <div id="screen-menu" class="screen active">
        <h1>KARƒ∞YER</h1>
        
        <div class="rel-box">
            <div class="rel-row"><span class="rel-name">PATRON</span><div class="rel-track"><div id="rel-boss" class="rel-val" style="width:50%"></div></div></div>
            <div class="rel-row"><span class="rel-name">TAKIM</span><div class="rel-track"><div id="rel-team" class="rel-val" style="width:50%"></div></div></div>
            <div class="rel-row"><span class="rel-name">TARAFTAR</span><div class="rel-track"><div id="rel-fans" class="rel-val" style="width:50%"></div></div></div>
        </div>

        <button class="nss-btn btn-green" onclick="startMatch()">
            <span>MA√áA √áIK</span> <span>‚öΩ</span>
        </button>

        <button class="nss-btn" onclick="showScreen('screen-shop')">
            <span>MARKET / E≈ûYA</span> <span>üõí</span>
        </button>
        
        <button class="nss-btn" onclick="showScreen('screen-league')">
            <span>Lƒ∞G TABLOSU</span> <span>üèÜ</span>
        </button>

        <div style="text-align:center; font-size:10px; color:#666; margin-top:20px;">
            Hafta: <span id="val-week">1</span>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <h1>MARKET</h1>
        <div class="item-row">
            <div>
                <div style="color:var(--yellow)">NRG ƒ∞√áECEƒûƒ∞</div>
                <div style="font-size:10px; color:#aaa">+100 Enerji</div>
            </div>
            <button class="nss-btn" style="margin:0; padding:10px;" onclick="buyItem('nrg')">$15</button>
        </div>
        <div class="item-row">
            <div>
                <div style="color:var(--yellow)">ALTIN KRAMPON</div>
                <div style="font-size:10px; color:#aaa">Daha sert ≈üutlar</div>
            </div>
            <button class="nss-btn" style="margin:0; padding:10px;" onclick="buyItem('boots')">$150</button>
        </div>
        <button class="nss-btn" onclick="showScreen('screen-menu')">GERƒ∞ D√ñN</button>
    </div>

    <div id="screen-league" class="screen">
        <h1>Lƒ∞G PUAN DURUMU</h1>
        <table style="width:100%; font-size:10px; border-collapse: collapse;">
            <thead><tr style="color:var(--yellow); text-align:left;"><th>TAKIM</th><th>P</th><th>AV</th></tr></thead>
            <tbody id="league-body">
                </tbody>
        </table>
        <br>
        <button class="nss-btn" onclick="showScreen('screen-menu')">GERƒ∞ D√ñN</button>
    </div>

    <div id="screen-match" class="screen">
        <div id="scoreboard">
            <span id="score-home">0</span> - <span id="score-away">0</span>
            <div style="font-size:12px; margin-top:5px; color:#888;" id="match-time">00:00</div>
        </div>
        <div id="match-log"></div>
    </div>

    <div id="game-layer">
        <canvas id="gameCanvas"></canvas>
        <div id="shoot-msg">HEDEF ALMAK ƒ∞√áƒ∞N KAYDIR!</div>
    </div>

</div>

<script>
    /**
     * NSS FULL WEB CLONE
     * Mantƒ±k: Veri Y√∂netimi -> Sim√ºlasyon -> 3D ≈ûut Motoru
     */

    // --- 1. OYUN VERƒ∞LERƒ∞ (Global State) ---
    const Game = {
        week: 1,
        money: 50,
        energy: 100,
        star: 1.0, // Oyuncu reytingi
        bootsLevel: 1.0, // ≈ûut g√ºc√º √ßarpanƒ±
        rels: { boss: 50, team: 50, fans: 50 },
        league: [
            { name: "Bƒ∞Zƒ∞M TAKIM", p: 0, w:0, d:0, l:0 },
            { name: "Galata SK", p: 0, w:0, d:0, l:0 },
            { name: "Fener SK", p: 0, w:0, d:0, l:0 },
            { name: "Be≈üikta≈ü JK", p: 0, w:0, d:0, l:0 },
            { name: "Trabzon SK", p: 0, w:0, d:0, l:0 }
        ]
    };

    const Match = {
        timer: 0,
        score: { h:0, a:0 },
        interval: null,
        active: false
    };

    // --- 2. ARAY√úZ Y√ñNETƒ∞Mƒ∞ ---
    function updateUI() {
        document.getElementById('val-money').innerText = "$" + Game.money;
        document.getElementById('val-star').innerText = Game.star.toFixed(1);
        document.getElementById('val-week').innerText = Game.week;
        
        let nrgBar = document.getElementById('bar-nrg');
        nrgBar.style.width = Game.energy + "%";
        nrgBar.style.backgroundColor = Game.energy > 50 ? "#27ae60" : (Game.energy > 20 ? "#f1c40f" : "#c0392b");

        document.getElementById('rel-boss').style.width = Game.rels.boss + "%";
        document.getElementById('rel-team').style.width = Game.rels.team + "%";
        document.getElementById('rel-fans').style.width = Game.rels.fans + "%";
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'screen-league') renderLeague();
    }

    function renderLeague() {
        // Puan durumuna g√∂re sƒ±rala
        Game.league.sort((a,b) => b.p - a.p);
        let html = "";
        Game.league.forEach((t, i) => {
            let color = t.name === "Bƒ∞Zƒ∞M TAKIM" ? "color:#27ae60" : "color:white";
            html += `<tr style="${color}; height:25px; border-bottom:1px solid #333;">
                <td>${i+1}. ${t.name}</td><td>${t.p}</td><td>0</td></tr>`;
        });
        document.getElementById('league-body').innerHTML = html;
    }

    function buyItem(type) {
        if(type === 'nrg') {
            if(Game.money >= 15) {
                Game.money -= 15; Game.energy = 100;
                alert("Enerji doldu!");
            } else alert("Yetersiz bakiye!");
        } else if (type === 'boots') {
            if(Game.money >= 150) {
                Game.money -= 150; Game.bootsLevel = 1.5;
                alert("Altƒ±n kramponlar alƒ±ndƒ±! ≈ûutlarƒ±n artƒ±k √ßok daha sert.");
            } else alert("Para yetmiyor!");
        }
        updateUI();
    }

    // --- 3. MA√á Sƒ∞M√úLASYONU ---
    function startMatch() {
        if(Game.energy < 10) { alert("√áok yorgunsun! Enerji i√ßeceƒüi al."); return; }
        
        showScreen('screen-match');
        Match.timer = 0; Match.score = {h:0, a:0};
        document.getElementById('match-log').innerHTML = "<div class='log-event'>Hakem d√ºd√ºƒü√ºn√º √ßaldƒ±!</div>";
        updateScoreboard();
        
        Match.interval = setInterval(matchLoop, 800);
    }

    function matchLoop() {
        Match.timer += 2;
        updateScoreboard();

        // Rastgele Olaylar
        let r = Math.random();
        
        // %10 ƒ∞htimalle Rakip Gol√º
        if(r < 0.10 && Match.timer > 5) {
            Match.score.a++;
            addLog("Rakip takƒ±m gol√º buldu!", "log-danger");
        } 
        // %15 ƒ∞htimalle Bƒ∞Zƒ∞M FIRSATIMIZ (Oyun Modu)
        else if (r > 0.85 && Match.timer < 88) {
            clearInterval(Match.interval);
            addLog(">>> TOP √ñN√úNDE KALDI! VUR!", "log-goal");
            setTimeout(open3DGame, 1000);
        }
        // Sƒ±radan yorum
        else if (r < 0.4) {
            const msgs = ["Orta sahada pasla≈üƒ±yoruz.", "Taraftar desteƒüi muazzam.", "Sert bir m√ºdahale oldu.", "Teknik direkt√∂r taktik veriyor."];
            addLog(msgs[Math.floor(Math.random() * msgs.length)]);
        }

        if(Match.timer >= 90) endMatch();
    }

    function addLog(msg, cls="") {
        let div = document.createElement('div');
        div.className = "log-event " + cls;
        div.innerText = Match.timer + "' " + msg;
        let box = document.getElementById('match-log');
        box.prepend(div);
    }
    
    function updateScoreboard() {
        document.getElementById('score-home').innerText = Match.score.h;
        document.getElementById('score-away').innerText = Match.score.a;
        document.getElementById('match-time').innerText = Match.timer + ":00";
    }

    function endMatch() {
        clearInterval(Match.interval);
        Game.week++;
        Game.energy -= 10;
        
        // Puan daƒüƒ±tƒ±mƒ±
        let pts = Match.score.h > Match.score.a ? 3 : (Match.score.h == Match.score.a ? 1 : 0);
        Game.league[0].p += pts;
        
        // Rakipleri sim√ºle et
        for(let i=1; i<Game.league.length; i++) Game.league[i].p += Math.floor(Math.random()*3);
        
        // Para kazanma
        let earnings = (pts * 10) + 10;
        Game.money += earnings;

        alert(`MA√á SONUCU: ${Match.score.h} - ${Match.score.a}\nKazanƒ±lan Para: $${earnings}`);
        updateUI();
        showScreen('screen-menu');
    }

    // --- 4. 3D ≈ûUT MOTORU (Kolayla≈ütƒ±rƒ±lmƒ±≈ü) ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let W, H;
    let Physics = { 
        ball: {x:0, y:0, z:0, vx:0, vy:0, vz:0}, 
        state: 'IDLE', // IDLE, AIM, MOVING
        keeperX: 0 
    };

    function resizeCanvas() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);

    function open3DGame() {
        resizeCanvas();
        document.getElementById('game-layer').style.display = 'flex';
        resetShot();
        requestAnimationFrame(gameLoop3D);
    }

    function resetShot() {
        Physics.ball = { x:0, y:150, z:0, vx:0, vy:0, vz:0 };
        Physics.state = 'AIM';
        Physics.keeperX = 0;
        document.getElementById('shoot-msg').innerText = "HEDEF ALMAK ƒ∞√áƒ∞N KAYDIR!";
    }

    // 3D -> 2D D√∂n√º≈ü√ºm (Basit Perspektif)
    function project(x, y, z) {
        let scale = 400 / (400 + z);
        return {
            x: (x * scale) + W/2,
            y: (y * scale) + H/2,
            s: scale
        };
    }

    function gameLoop3D() {
        if(document.getElementById('game-layer').style.display === 'none') return;

        ctx.clearRect(0,0,W,H);
        
        // --- Fƒ∞Zƒ∞K ---
        if(Physics.state === 'MOVING') {
            Physics.ball.x += Physics.ball.vx;
            Physics.ball.y += Physics.ball.vy;
            Physics.ball.z += Physics.ball.vz;
            
            Physics.ball.vy += 0.5; // Yer√ßekimi
            Physics.ball.vz *= 0.99; // S√ºrt√ºnme

            // Yer kontrol√º
            if(Physics.ball.y > 150) {
                Physics.ball.y = 150; Physics.ball.vy *= -0.6;
            }

            // GOL KONTROL√ú (KALE = Geni≈ülik 300, Y√ºkseklik 120, Derinlik 600)
            if(Physics.ball.z > 600) {
                let inGoalX = Physics.ball.x > -150 && Physics.ball.x < 150;
                let inGoalY = Physics.ball.y < 150 && Physics.ball.y > 30; // 150 yer, 30 √ºst direk
                
                // Kaleci Mesafesi
                let keeperDist = Math.abs(Physics.ball.x - Physics.keeperX);
                
                if(inGoalX && inGoalY) {
                    if(keeperDist < 40) { // Kurtardƒ±
                        close3DGame(false, "KALECƒ∞ KURTARDI!");
                    } else { // GOL
                        close3DGame(true, "GOOOOOOL!");
                    }
                } else {
                    close3DGame(false, "AUT!");
                }
                return; // D√∂ng√ºy√º kes
            }
        }

        // Kaleci Yapay Zekasƒ±
        if(Physics.state === 'MOVING' && Physics.ball.z > 100) {
            // Kaleci yava≈ü√ßa topa gider (Zor deƒüil)
            Physics.keeperX += (Physics.ball.x - Physics.keeperX) * 0.05; 
        }

        // --- √áƒ∞Zƒ∞M ---
        drawScene();
        requestAnimationFrame(gameLoop3D);
    }

    function drawScene() {
        // Zemin
        ctx.fillStyle = "#228B22";
        let groundPoly = [
            project(-1000, 150, 0), project(1000, 150, 0),
            project(1000, 150, 2000), project(-1000, 150, 2000)
        ];
        ctx.beginPath();
        ctx.moveTo(groundPoly[0].x, groundPoly[0].y);
        for(let p of groundPoly) ctx.lineTo(p.x, p.y);
        ctx.fill();

        // Kale (Geni≈ülik 300 - KOLAY)
        ctx.strokeStyle = "white"; ctx.lineWidth = 5;
        let tl = project(-150, 30, 600); let tr = project(150, 30, 600);
        let bl = project(-150, 150, 600); let br = project(150, 150, 600);
        
        ctx.beginPath(); 
        ctx.moveTo(bl.x, bl.y); ctx.lineTo(tl.x, tl.y); 
        ctx.lineTo(tr.x, tr.y); ctx.lineTo(br.x, br.y); 
        ctx.stroke();

        // Aƒülar
        ctx.fillStyle = "rgba(255,255,255,0.2)";
        ctx.fillRect(tl.x, tl.y, tr.x - tl.x, bl.y - tl.y);

        // Kaleci
        let kPos = project(Physics.keeperX, 150, 580);
        let kH = 80 * kPos.s; let kW = 40 * kPos.s;
        ctx.fillStyle = "red";
        ctx.fillRect(kPos.x - kW/2, kPos.y - kH, kW, kH);

        // Top
        let bPos = project(Physics.ball.x, Physics.ball.y, Physics.ball.z);
        let bSize = 12 * bPos.s;
        ctx.fillStyle = "white"; ctx.beginPath();
        ctx.arc(bPos.x, bPos.y, bSize, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle="black"; ctx.lineWidth=1; ctx.stroke();
    }

    function close3DGame(isGoal, msg) {
        document.getElementById('shoot-msg').innerText = msg;
        document.getElementById('shoot-msg').style.color = isGoal ? "#00ff00" : "red";
        document.getElementById('shoot-msg').style.fontSize = "24px";
        document.getElementById('shoot-msg').style.fontWeight = "bold";

        setTimeout(() => {
            document.getElementById('game-layer').style.display = 'none';
            if(isGoal) {
                Match.score.h++;
                addLog("HARƒ∞KA Bƒ∞R GOL!", "log-goal");
                Game.star += 0.2;
            } else {
                addLog("Fƒ±rsat ka√ßtƒ±...", "log-danger");
            }
            // Ma√ß devam etsin
            Match.interval = setInterval(matchLoop, 800);
        }, 1500);
    }

    // --- SWIPE KONTROL√ú (GELƒ∞≈ûMƒ∞≈û) ---
    let touchStart = {x:0, y:0};
    
    document.addEventListener('touchstart', e => {
        touchStart.x = e.touches[0].clientX;
        touchStart.y = e.touches[0].clientY;
    });
    
    document.addEventListener('touchend', e => {
        if(Physics.state !== 'AIM' || document.getElementById('game-layer').style.display === 'none') return;
        
        let dx = e.changedTouches[0].clientX - touchStart.x;
        let dy = e.changedTouches[0].clientY - touchStart.y;
        
        // Yukarƒ± doƒüru swipe yapƒ±ldƒ± mƒ±?
        if(dy < -30) {
            Physics.state = 'MOVING';
            let speed = 25 * Game.bootsLevel; 
            
            // X Hƒ±zƒ±: Saƒüa sola kaydƒ±rma miktarƒ±
            Physics.ball.vx = dx * 0.15; 
            
            // Y Hƒ±zƒ±: Yukarƒ± kaydƒ±rma (Negatif deƒüer yukarƒ±dƒ±r)
            Physics.ball.vy = dy * 0.3; 
            
            // Z Hƒ±zƒ±: ƒ∞leri gidi≈ü (Sabit hƒ±zlƒ±)
            Physics.ball.vz = speed;

            document.getElementById('shoot-msg').innerText = "";
        }
    });

    // PC i√ßin Mouse Desteƒüi
    document.addEventListener('mousedown', e => { touchStart.x = e.clientX; touchStart.y = e.clientY; });
    document.addEventListener('mouseup', e => {
        if(Physics.state !== 'AIM' || document.getElementById('game-layer').style.display === 'none') return;
        let dx = e.clientX - touchStart.x; let dy = e.clientY - touchStart.y;
        if(dy < -30) {
            Physics.state = 'MOVING';
            let speed = 25 * Game.bootsLevel;
            Physics.ball.vx = dx * 0.15; Physics.ball.vy = dy * 0.3; Physics.ball.vz = speed;
        }
    });

    // Ba≈ülangƒ±√ß
    updateUI();

</script>
</body>
</html>
        flex-direction: column;
        justify-content: space-between;
    }

    #score-board {
        margin-top: 20px;
        text-align: center;
        color: white;
        text-shadow: 0 4px 10px rgba(0,0,0,0.8);
    }
    .score-txt { font-size: 40px; font-weight: 700; letter-spacing: 2px; }
    .status-txt { font-size: 14px; opacity: 0.8; font-weight: 500; }

    #controls-hint {
        text-align: center;
        margin-bottom: 50px;
        color: rgba(255,255,255,0.6);
        font-size: 14px;
        text-transform: uppercase;
        animation: fade 2s infinite;
    }

    @keyframes fade { 0%,100%{opacity:0.4} 50%{opacity:1} }

    /* Gol Efekti Yazƒ±sƒ± */
    #goal-overlay {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%) scale(0);
        color: #f1c40f;
        font-size: 80px;
        font-weight: 900;
        text-shadow: 0 0 20px rgba(243, 156, 18, 0.8);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
        z-index: 10;
    }

</style>
</head>
<body>

<div id="game-container">
    <canvas id="canvas"></canvas>
    
    <div id="ui-layer">
        <div id="score-board">
            <div class="score-txt"><span id="s-home">0</span> - <span id="s-away">0</span></div>
            <div class="status-txt" id="status-msg">≈ûut √ßekmek i√ßin kaydƒ±r</div>
        </div>
        <div id="controls-hint">
            <p>üëÜ Parmaƒüƒ±nƒ± Kaydƒ±rarak ≈ûut √áek</p>
        </div>
    </div>

    <div id="goal-overlay">GOL!</div>
</div>

<script>
/**
 * NSS PRO 3D ENGINE
 * √ñzellikler: Pseudo-3D Projection, Swipe Fizikleri, Par√ßacƒ±k Sistemi
 */

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// --- EKRAN AYARLARI ---
let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- 3D AYARLARI ---
const FOV = 350; // Field of View (Kamera a√ßƒ±sƒ±)
const CAM_Y = -120; // Kamera y√ºksekliƒüi (daha negatif = daha yukarƒ±dan)
const CAM_Z = -400; // Kamera uzaklƒ±ƒüƒ±
const GROUND_Y = 150; // Zemin seviyesi

// --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
let score = { h: 0, a: 0 };
let gameState = 'AIM'; // AIM, SHOT, CELEBRATE, RESET
let particles = [];

// --- Fƒ∞Zƒ∞K NESNELERƒ∞ ---
let ball = { x: 0, y: GROUND_Y, z: 0, vx: 0, vy: 0, vz: 0, r: 10, spin: 0 };
let goal = { w: 220, h: 100, z: 600 }; // Kale boyutlarƒ± ve uzaklƒ±ƒüƒ±
let keeper = { x: 0, y: GROUND_Y, w: 40, h: 90, diveTarget: 0, state: 'IDLE' };
let netNodes = []; // Aƒü sim√ºlasyonu i√ßin noktalar

// --- KONTROL (SWIPE) ---
let touchStart = { x: 0, y: 0, time: 0 };
let isTouching = false;

// --- PROJECTION FONKSƒ∞YONU (3D -> 2D) ---
function project(x, y, z) {
    // Kameraya g√∂re g√∂receli konum
    const scale = FOV / (FOV + z + (-CAM_Z));
    const x2d = (x * scale) + W / 2;
    const y2d = ((y + CAM_Y) * scale) + H / 2;
    return { x: x2d, y: y2d, s: scale };
}

// --- OYUN D√ñNG√úS√ú ---
function loop() {
    // 1. Fizik Hesaplamalarƒ±
    updatePhysics();
    
    // 2. √áizim
    drawBackground();
    drawGround();
    drawGoalBack();
    drawNet();
    drawGoalFront();
    drawKeeper();
    drawBall();
    drawParticles();

    requestAnimationFrame(loop);
}

// --- Fƒ∞Zƒ∞K MOTORU ---
function updatePhysics() {
    if (gameState === 'SHOT') {
        // Hƒ±z uygula
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.z += ball.vz;
        
        // Yer√ßekimi
        ball.vy += 0.5; 
        
        // Hava s√ºrt√ºnmesi (top yava≈ülar)
        ball.vz *= 0.995; 

        // Falso (Spin) etkisi - Magnus Effect (Basitle≈ütirilmi≈ü)
        ball.x += ball.spin;

        // YERLE ETKƒ∞LE≈ûƒ∞M (Zƒ±plama)
        if (ball.y > GROUND_Y) {
            ball.y = GROUND_Y;
            ball.vy *= -0.6; // Enerji kaybƒ±
            ball.vx *= 0.8;
            // Eƒüer √ßok yava≈üladƒ±ysa durdur
            if(Math.abs(ball.vy) < 1 && Math.abs(ball.vz) < 2) {
                // ≈ûut bitti
                setTimeout(resetRound, 1000);
            }
        }

        // KALE KONTROL√ú
        // Kale d√ºzlemine ula≈ütƒ± mƒ±?
        if (ball.z > goal.z && ball.z < goal.z + 50) {
            // Kale sƒ±nƒ±rlarƒ± i√ßinde mi?
            if (ball.x > -goal.w/2 && ball.x < goal.w/2 && ball.y < GROUND_Y && ball.y > GROUND_Y - goal.h) {
                // Kaleci kurtardƒ± mƒ±?
                let kDist = Math.hypot(ball.x - keeper.x, ball.y - (keeper.y - 40));
                
                if (kDist < 40) {
                    // Kurtarƒ±≈ü
                    ball.vz *= -0.5; // Geri seker
                    ball.vx += (Math.random()-0.5) * 10;
                    showToast("KALECƒ∞ KURTARDI!");
                    gameState = 'RESET';
                    setTimeout(resetRound, 2000);
                } else {
                    // GOL!
                    if(gameState !== 'CELEBRATE') {
                        goalScored();
                    }
                }
            } else if (ball.x < -goal.w/2 || ball.x > goal.w/2 || ball.y < GROUND_Y - goal.h) {
                // Dƒ±≈üarƒ±
                 if (ball.z > goal.z + 10) {
                    showToast("AUT!");
                    setTimeout(resetRound, 1500);
                 }
            }
        }
        
        // √áok uzaƒüa gittiyse
        if(ball.z > 1000) resetRound();
    }

    // Kaleci Yapay Zekasƒ±
    if (gameState === 'SHOT' && ball.z > 100) {
        // Topa doƒüru hareket et (Gecikmeli)
        let targetX = ball.x;
        // ƒ∞nsan hatasƒ± ekle
        keeper.x += (targetX - keeper.x) * 0.08;
        
        // Zƒ±plama (Top y√ºksekse)
        if (ball.y < GROUND_Y - 40 && keeper.y === GROUND_Y) {
            keeper.y -= 5; // Basit zƒ±plama
        }
    } else {
        // Kaleci eski yerine d√∂n
        keeper.x += (0 - keeper.x) * 0.05;
        keeper.y = GROUND_Y;
    }
}

// --- G√ñRSELLE≈ûTƒ∞RME (√áƒ∞Zƒ∞M) ---

function drawBackground() {
    // G√∂ky√ºz√º Gradient
    let grd = ctx.createLinearGradient(0, 0, 0, H);
    grd.addColorStop(0, "#1e3c72");
    grd.addColorStop(0.5, "#2a5298");
    grd.addColorStop(1, "#111");
    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, W, H);
}

function drawGround() {
    // Zemin Gradient (Ufuk √ßizgisi efekti)
    let p1 = project(-1000, GROUND_Y, 0);
    let p2 = project(1000, GROUND_Y, 2000); // Sonsuzluk
    
    // √áim Alanƒ±
    ctx.fillStyle = "#2ecc71";
    // 3D D√ºzlem √ßizimi (Basit Trapezoid)
    let tl = project(-800, GROUND_Y, 2000);
    let tr = project(800, GROUND_Y, 2000);
    let bl = project(-1500, GROUND_Y, -200);
    let br = project(1500, GROUND_Y, -200);

    ctx.beginPath();
    ctx.moveTo(tl.x, tl.y);
    ctx.lineTo(tr.x, tr.y);
    ctx.lineTo(br.x, br.y);
    ctx.lineTo(bl.x, bl.y);
    ctx.fill();

    // √áim √áizgileri (Perspektif i√ßin)
    ctx.strokeStyle = "rgba(0,0,0,0.1)";
    ctx.lineWidth = 2;
    for (let z = 0; z < 2000; z += 100) {
        let l1 = project(-800, GROUND_Y, z);
        let l2 = project(800, GROUND_Y, z);
        ctx.beginPath(); ctx.moveTo(l1.x, l1.y); ctx.lineTo(l2.x, l2.y); ctx.stroke();
    }
}

function drawGoalBack() {
    // Kale arka direkleri
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#bdc3c7";
    
    let depth = 80;
    let tl = project(-goal.w/2, GROUND_Y - goal.h, goal.z);
    let tr = project(goal.w/2, GROUND_Y - goal.h, goal.z);
    let bl = project(-goal.w/2, GROUND_Y, goal.z);
    let br = project(goal.w/2, GROUND_Y, goal.z);

    let tlb = project(-goal.w/2, GROUND_Y - goal.h, goal.z + depth);
    let trb = project(goal.w/2, GROUND_Y - goal.h, goal.z + depth);
    let blb = project(-goal.w/2, GROUND_Y, goal.z + depth);
    let brb = project(goal.w/2, GROUND_Y, goal.z + depth);
    
    ctx.beginPath();
    // Arka √ßer√ßeve
    ctx.moveTo(tlb.x, tlb.y); ctx.lineTo(trb.x, trb.y);
    ctx.lineTo(brb.x, brb.y); ctx.moveTo(tlb.x, tlb.y); ctx.lineTo(blb.x, blb.y);
    // Baƒülantƒ±lar
    ctx.moveTo(tl.x, tl.y); ctx.lineTo(tlb.x, tlb.y);
    ctx.moveTo(tr.x, tr.y); ctx.lineTo(trb.x, trb.y);
    ctx.moveTo(bl.x, bl.y); ctx.lineTo(blb.x, blb.y);
    ctx.moveTo(br.x, br.y); ctx.lineTo(brb.x, brb.y);
    ctx.stroke();
}

function drawNet() {
    // Aƒü deseni
    ctx.strokeStyle = "rgba(255,255,255,0.15)";
    ctx.lineWidth = 1;
    let depth = 80;
    
    // Dikey √ßizgiler
    for(let i=0; i<=10; i++) {
        let x = -goal.w/2 + (goal.w * (i/10));
        let pTop = project(x, GROUND_Y - goal.h, goal.z);
        let pBackTop = project(x, GROUND_Y - goal.h, goal.z + depth);
        let pBackBot = project(x, GROUND_Y, goal.z + depth);
        
        ctx.beginPath();
        ctx.moveTo(pTop.x, pTop.y); ctx.lineTo(pBackTop.x, pBackTop.y); ctx.lineTo(pBackBot.x, pBackBot.y);
        ctx.stroke();
    }
    // Yatay √ßizgiler
    for(let i=0; i<=5; i++) {
        let y = (GROUND_Y - goal.h) + (goal.h * (i/5));
        let pL = project(-goal.w/2, y, goal.z + depth);
        let pR = project(goal.w/2, y, goal.z + depth);
        ctx.beginPath(); ctx.moveTo(pL.x, pL.y); ctx.lineTo(pR.x, pR.y); ctx.stroke();
    }
}

function drawGoalFront() {
    // √ñn direkler (Daha kalƒ±n)
    ctx.lineWidth = 8;
    ctx.strokeStyle = "#ecf0f1";
    
    let tl = project(-goal.w/2, GROUND_Y - goal.h, goal.z);
    let tr = project(goal.w/2, GROUND_Y - goal.h, goal.z);
    let bl = project(-goal.w/2, GROUND_Y, goal.z);
    let br = project(goal.w/2, GROUND_Y, goal.z);

    ctx.beginPath();
    ctx.moveTo(bl.x, bl.y); ctx.lineTo(tl.x, tl.y); // Sol
    ctx.lineTo(tr.x, tr.y); // √úst
    ctx.lineTo(br.x, br.y); // Saƒü
    ctx.stroke();
}

function drawKeeper() {
    let p = project(keeper.x, keeper.y, goal.z - 20); // Kaleci √ßizgiden biraz √∂nde
    let h = 90 * p.s;
    let w = 40 * p.s;

    // G√∂lge
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.beginPath(); ctx.ellipse(p.x, p.y, w/1.5, w/4, 0, 0, Math.PI*2); ctx.fill();

    // Kaleci (Basit ≈ûekil)
    ctx.fillStyle = "#e74c3c"; // Forma
    ctx.fillRect(p.x - w/2, p.y - h, w, h/2); // G√∂vde
    ctx.fillStyle = "#2c3e50"; // ≈ûort
    ctx.fillRect(p.x - w/2, p.y - h/2, w, h/4);
    
    // Kafa
    ctx.fillStyle = "#f1c40f";
    ctx.beginPath(); ctx.arc(p.x, p.y - h - (10*p.s), 12*p.s, 0, Math.PI*2); ctx.fill();
    
    // Eldivenler
    ctx.fillStyle = "white";
    // Kollarƒ±n durumu (Atlama vs)
    if(Math.abs(keeper.x - ball.x) > 20) {
        // Uzatmƒ±≈ü el
        ctx.fillRect(p.x - w, p.y - h/1.5, 10*p.s, 10*p.s);
        ctx.fillRect(p.x + w - 10*p.s, p.y - h/1.5, 10*p.s, 10*p.s);
    }
}

function drawBall() {
    let p = project(ball.x, ball.y, ball.z);
    let size = ball.r * p.s;

    // G√∂lge
    if(ball.y < GROUND_Y) {
        let shadowP = project(ball.x, GROUND_Y, ball.z);
        let shadowSize = size * (1 - (GROUND_Y - ball.y)/200); // Y√ºkseldik√ße k√º√ß√ºl√ºr
        if(shadowSize > 0) {
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.beginPath();
            ctx.ellipse(shadowP.x, shadowP.y, shadowSize, shadowSize/2, 0, 0, Math.PI*2);
            ctx.fill();
        }
    }

    // Top
    let grad = ctx.createRadialGradient(p.x - size/3, p.y - size/3, size/10, p.x, p.y, size);
    grad.addColorStop(0, "#fff");
    grad.addColorStop(1, "#bdc3c7");
    
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
    ctx.fill();

    // Top Detayƒ± (D√∂n√º≈ü√º hissettirmek i√ßin)
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(p.x, p.y, size/1.5, 0 + ball.z/50, 2 + ball.z/50); // D√∂n√º≈ü sim√ºlasyonu
    ctx.stroke();
}

function drawParticles() {
    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.2; // Gravity
        p.life -= 0.02;

        if(p.life > 0) {
            let proj = project(p.x, p.y, goal.z);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.fillRect(proj.x, proj.y, 5 * proj.s, 5 * proj.s);
            ctx.globalAlpha = 1;
        } else {
            particles.splice(i, 1);
            i--;
        }
    }
}

// --- GOL MANTIƒûI ---
function goalScored() {
    gameState = 'CELEBRATE';
    score.h++;
    document.getElementById('s-home').innerText = score.h;
    
    // GOL Overlay Efekti
    let overlay = document.getElementById('goal-overlay');
    overlay.style.transform = "translate(-50%, -50%) scale(1)";
    
    // Konfeti Patlat
    for(let i=0; i<50; i++) {
        particles.push({
            x: (Math.random() - 0.5) * goal.w, // Kalenin i√ßinde rastgele
            y: GROUND_Y - goal.h/2,
            vx: (Math.random() - 0.5) * 10,
            vy: -Math.random() * 15,
            color: `hsl(${Math.random()*360}, 100%, 50%)`,
            life: 1.0
        });
    }

    setTimeout(() => {
        overlay.style.transform = "translate(-50%, -50%) scale(0)";
        resetRound();
    }, 2500);
}

function showToast(msg) {
    document.getElementById('status-msg').innerText = msg;
    document.getElementById('status-msg').style.color = "#f1c40f";
    setTimeout(() => {
        document.getElementById('status-msg').innerText = "≈ûut √ßekmek i√ßin kaydƒ±r";
        document.getElementById('status-msg').style.color = "rgba(255,255,255,0.8)";
    }, 2000);
}

function resetRound() {
    gameState = 'AIM';
    ball.x = 0;
    ball.y = GROUND_Y;
    ball.z = 0;
    ball.vx = 0; ball.vy = 0; ball.vz = 0; ball.spin = 0;
    keeper.x = 0;
}

// --- DOKUNMATƒ∞K / MOUSE KONTROLLERƒ∞ ---

document.addEventListener('touchstart', handleStart, {passive: false});
document.addEventListener('touchend', handleEnd, {passive: false});
document.addEventListener('mousedown', handleStart);
document.addEventListener('mouseup', handleEnd);

function handleStart(e) {
    if(gameState !== 'AIM') return;
    e.preventDefault(); // Scroll engelle
    
    let x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
    let y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
    
    touchStart.x = x;
    touchStart.y = y;
    touchStart.time = Date.now();
    isTouching = true;
}

function handleEnd(e) {
    if(!isTouching || gameState !== 'AIM') return;
    isTouching = false;
    
    let x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
    let y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
    let time = Date.now() - touchStart.time;

    // Swipe Vekt√∂r√º
    let dx = x - touchStart.x;
    let dy = y - touchStart.y;
    
    // Hƒ±z Hesaplama (Mesafe / Zaman)
    let dist = Math.hypot(dx, dy);
    let speed = Math.min(dist / time * 20, 45); // Max hƒ±z limiti
    
    if (dist < 20) return; // √áok kƒ±sa dokunu≈ülarƒ± yoksay

    // A√ßƒ± Hesaplama
    // dx: Saƒüa sola gidi≈ü
    // dy: Yukarƒ± a≈üaƒüƒ± (Negatif yukarƒ±dƒ±r)

    ball.vx = dx * 0.15; // Yatay hƒ±z
    ball.vy = dy * 0.25; // Dikey hƒ±z (Havalanma)
    ball.vz = speed * 1.5; // ƒ∞leri hƒ±z
    
    // Falso Hesaplama (Curve)
    // Eƒüer parmak d√ºmd√ºz gitmediyse falso ver (Basit mantƒ±k: X deƒüi≈üimi)
    ball.spin = -(dx * 0.005); 

    gameState = 'SHOT';
    document.getElementById('controls-hint').style.display = 'none';
}

// Oyunu Ba≈ülat
loop();

</script>
</body>
</html>
kem d√ºd√ºƒü√ºn√º √ßaldƒ±!<br>";
    updateMatchScore();
    
    match.interval = setInterval(matchLoop, 500); // Hƒ±zlƒ± sim√ºlasyon
}

function matchLoop() {
    match.time += 2;
    updateMatchScore();

    // Olay √úretici
    let r = Math.random();
    
    // 1. Yazƒ±sal Olaylar
    if(r < 0.2) logMatch("Orta sahada top √ßeviriyoruz.");
    else if(r < 0.3) logMatch("Rakip baskƒ±yƒ± arttƒ±rdƒ±.");
    else if(r < 0.4 && match.time > 10) {
        // RAKƒ∞P GOL
        if(Math.random() > 0.6) {
            match.scoreA++;
            logMatch("GOL! Rakip affetmedi.", "red");
        } else {
            logMatch("Kalecimiz harika kurtardƒ±!");
        }
    }
    
    // 2. OYUNCU FIRSATI (AKSƒ∞YON)
    else if (r > 0.85) {
        clearInterval(match.interval);
        logMatch(">>> ARA PASINI ALDIN! VUR ≈ûUTUNU!", "gold");
        setTimeout(openShootingGame, 1000);
    }

    if(match.time >= 90) endMatch();
}

function updateMatchScore() {
    document.getElementById('match-score').innerText = `${match.scoreH} - ${match.scoreA}`;
    document.getElementById('match-timer').innerText = match.time + ":00";
}

function logMatch(msg, color="white") {
    let div = document.createElement('div');
    div.innerText = `${match.time}' ${msg}`;
    div.style.color = color === "red" ? "#e74c3c" : (color === "gold" ? "#f1c40f" : "#ccc");
    div.style.borderBottom = "1px solid #333";
    div.style.padding = "2px 0";
    let box = document.getElementById('news-ticker');
    box.prepend(div);
}

// --- ≈ûUT MEKANƒ∞ƒûƒ∞ (MODERN CANVAS) ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let game = { phase: 'IDLE', ball: {}, arrow: {} };
let animId;

function openShootingGame() {
    document.getElementById('game-layer').style.display = 'flex';
    resizeCanvas();
    resetShot();
    game.phase = 'AIM_DIR'; // 1. A≈üama: Y√∂n
    document.getElementById('instruction-text').innerText = "Y√ñN ƒ∞√áƒ∞N DOKUN";
    loop();
}

function resetShot() {
    game.ball = { x: canvas.width/2, y: canvas.height - 100, z: 1, dx:0, dy:0, dz:0 };
    game.arrow = { angle: -Math.PI/2, swing: 0.05, height: 0 }; 
    game.keeper = { x: canvas.width/2, dir: 1 };
}

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

// OYUN D√ñNG√úS√ú
function loop() {
    updatePhysics();
    drawScene();
    if(game.phase !== 'ENDED') animId = requestAnimationFrame(loop);
}

function updatePhysics() {
    // Kaleci Hareketi
    game.keeper.x += 2 * game.keeper.dir;
    if(game.keeper.x > canvas.width/2 + 100 || game.keeper.x < canvas.width/2 - 100) game.keeper.dir *= -1;

    // 1. Y√∂n Se√ßimi (Ok sallanƒ±r)
    if(game.phase === 'AIM_DIR') {
        game.arrow.angle += game.arrow.swing;
        if(game.arrow.angle < -Math.PI + 0.5 || game.arrow.angle > -0.5) game.arrow.swing *= -1;
    }
    // 2. Y√ºkseklik/G√º√ß Se√ßimi (Bar yukarƒ± a≈üaƒüƒ± gider - sim√ºle ediyoruz)
    else if (game.phase === 'AIM_HEIGHT') {
        // Burada basitlik adƒ±na otomatik ge√ßiyoruz ama g√∂rsel olarak ok rengi deƒüi≈üebilir
    }
    // 3. ≈ûut Hareketi
    else if (game.phase === 'MOVING') {
        game.ball.x += game.ball.dx;
        game.ball.y += game.ball.dy;
        game.ball.z -= 0.015; // Top uzakla≈üƒ±r (Scale k√º√ß√ºl√ºr)
        
        // Yer√ßekimi efekti (Y√ºkseklik)
        game.ball.dy += 0.1; 

        // Gol Kontrol√º (Derinlik Z < 0.5 olduƒüunda kale √ßizgisine gelmi≈ütir)
        if(game.ball.z < 0.4) {
            checkGoal();
        }
        
        // Dƒ±≈üarƒ± √ßƒ±kma
        if(game.ball.x < 0 || game.ball.x > canvas.width || game.ball.y > canvas.height) {
            endShot(false, "DI≈ûARI!");
        }
    }
}

function checkGoal() {
    let goalW = 200; // Kale geni≈üliƒüi
    let goalH = 100; // Kale y√ºksekliƒüi
    let goalX = canvas.width/2 - 100;
    let goalY = 150; // Kale √ºst direk Y pozisyonu (yakla≈üƒ±k)

    // Basit √ßarpƒ±≈üma mantƒ±ƒüƒ±
    let hitX = game.ball.x > goalX && game.ball.x < goalX + goalW;
    let hitY = game.ball.y > goalY && game.ball.y < goalY + goalH;
    
    // Kaleci kurtarƒ±≈üƒ±
    let saved = Math.abs(game.ball.x - game.keeper.x) < 30;

    if(hitX && hitY && !saved) {
        endShot(true, "GOOOOL!!!");
    } else if (saved && hitX && hitY) {
        endShot(false, "KALECƒ∞ KURTARDI!");
    } else {
        endShot(false, "AUT!");
    }
}

function endShot(isGoal, msg) {
    game.phase = 'ENDED';
    cancelAnimationFrame(animId);
    
    // Canvas √ºzerine yazƒ± yaz
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, canvas.height/2 - 50, canvas.width, 100);
    ctx.fillStyle = isGoal ? "#2ecc71" : "#e74c3c";
    ctx.font = "bold 40px Roboto";
    ctx.textAlign = "center";
    ctx.fillText(msg, canvas.width/2, canvas.height/2 + 15);

    setTimeout(() => {
        document.getElementById('game-layer').style.display = 'none';
        
        if(isGoal) {
            match.scoreH++;
            state.rating = Math.min(10, state.rating + 0.3);
            state.money += 20; // Gol primi
            state.relationships.fans += 2;
            logMatch("M√úKEMMEL GOL! " + msg, "gold");
        } else {
            state.rating = Math.max(1, state.rating - 0.1);
            logMatch("Fƒ±rsat ka√ßtƒ±: " + msg, "red");
        }
        
        state.energy -= 5;
        updateHUD();
        updateMatchScore();
        match.interval = setInterval(matchLoop, 500); // Ma√ßƒ± s√ºrd√ºr
    }, 1500);
}

// √áƒ∞Zƒ∞M FONKSƒ∞YONLARI (G√∂rsellik)
function drawScene() {
    ctx.clearRect(0,0,canvas.width, canvas.height);

    // 1. KALE (Perspektif)
    let gw = 200, gh = 120, gx = canvas.width/2 - 100, gy = 150;
    
    // Arka direkler (daha k√º√ß√ºk - derinlik hissi)
    ctx.strokeStyle = "rgba(255,255,255,0.6)";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(gx + 20, gy + 20); ctx.lineTo(gx + gw - 20, gy + 20); // √úst arka
    ctx.lineTo(gx + gw - 20, gy + gh); // Saƒü arka
    ctx.moveTo(gx + 20, gy + gh); ctx.lineTo(gx + 20, gy + 20); // Sol arka
    ctx.stroke();

    // √ñn direkler (daha b√ºy√ºk)
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(gx, gy + gh + 20); ctx.lineTo(gx, gy); // Sol Direk
    ctx.lineTo(gx + gw, gy); // √úst Direk
    ctx.lineTo(gx + gw, gy + gh + 20); // Saƒü Direk
    ctx.stroke();

    // Aƒülar
    ctx.fillStyle = "rgba(255,255,255,0.1)";
    ctx.fillRect(gx, gy, gw, gh + 20);

    // 2. KALECƒ∞ (Vekt√∂rel Modern)
    let kx = game.keeper.x;
    let ky = gy + gh - 10;
    // Kaleci g√∂lge
    ctx.fillStyle = "rgba(0,0,0,0.3)";
    ctx.beginPath(); ctx.ellipse(kx, ky+35, 20, 5, 0, 0, Math.PI*2); ctx.fill();
    // Kaleci v√ºcut
    ctx.fillStyle = "#e74c3c";
    ctx.beginPath(); ctx.arc(kx, ky, 15, 0, Math.PI*2); ctx.fill(); // Kafa
    ctx.fillRect(kx-12, ky+15, 24, 30); // G√∂vde
    
    // 3. OK (Aiming)
    if(game.phase === 'AIM_DIR') {
        ctx.save();
        ctx.translate(game.ball.x, game.ball.y);
        ctx.rotate(game.arrow.angle);
        
        // Modern Ok (Gradient)
        let grad = ctx.createLinearGradient(0,0,150,0);
        grad.addColorStop(0, "rgba(241, 196, 15, 0.8)");
        grad.addColorStop(1, "rgba(241, 196, 15, 0)");
        
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.moveTo(0, -5); ctx.lineTo(150, -20); ctx.lineTo(150, 20); ctx.lineTo(0, 5);
        ctx.fill();
        ctx.restore();
    }

    // 4. TOP (3D G√∂r√ºn√ºml√º)
    let scale = game.ball.z;
    let r = 12 * scale;
    
    // Top G√∂lgesi (Yerden y√ºksekliƒüe g√∂re ≈üeffafla≈üƒ±r)
    ctx.fillStyle = `rgba(0,0,0,${0.4 * scale})`;
    ctx.beginPath();
    ctx.ellipse(game.ball.x, game.ball.y + (20/scale), r, r/2, 0, 0, Math.PI*2);
    ctx.fill();

    // Topun kendisi
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.arc(game.ball.x, game.ball.y, r, 0, Math.PI*2); ctx.fill();
    // Top Deseni (Hexagon effect)
    ctx.strokeStyle = "#333"; ctx.lineWidth = 1 * scale;
    ctx.beginPath(); 
    ctx.moveTo(game.ball.x - r/2, game.ball.y - r/2); 
    ctx.lineTo(game.ball.x + r/2, game.ball.y + r/2);
    ctx.stroke();
}

// ƒ∞NPUT Y√ñNETƒ∞Mƒ∞
document.getElementById('game-layer').addEventListener('mousedown', handleInput);
document.getElementById('game-layer').addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); });

function handleInput() {
    if(game.phase === 'AIM_DIR') {
        game.phase = 'MOVING'; // Direkt ≈üuta ge√ßiyoruz (Basit modern hissi i√ßin)
        // Y√ºkseklik rastgele ama skill'e baƒülƒ± biraz
        let power = 12 * state.bootsMultiplier;
        
        game.ball.dx = Math.cos(game.arrow.angle) * power;
        game.ball.dy = Math.sin(game.arrow.angle) * power; 
        
        // Falso efekti (Skill ne kadar y√ºksekse o kadar iyi gider)
        game.ball.dy -= (state.skill / 50); 
        
        document.getElementById('instruction-text').innerText = "";
    }
}


// --- Dƒ∞ƒûER FONKSƒ∞YONLAR ---

function endMatch() {
    clearInterval(match.interval);
    state.week++;
    state.energy -= 10;
    
    // Lig Tablosu Sim√ºlasyonu
    state.league[0].p += match.scoreH > match.scoreA ? 3 : (match.scoreH == match.scoreA ? 1 : 0);
    // Diƒüer takƒ±mlar rastgele
    for(let i=1; i<state.league.length; i++) {
        state.league[i].p += Math.floor(Math.random() * 3); // 0, 1 veya 2 (Basit)
    }
    // Sƒ±rala
    state.league.sort((a,b) => b.p - a.p);
    renderLeague();

    // ƒ∞li≈üki G√ºncellemeleri
    let msg = match.scoreH > match.scoreA ? "Kazandƒ±k! Takƒ±m mutlu." : "K√∂t√º sonu√ß...";
    if(match.scoreH > match.scoreA) state.relationships.boss += 5;
    else state.relationships.boss -= 5;

    alert(`MA√á SONUCU: ${match.scoreH} - ${match.scoreA}\n${msg}`);
    
    switchScreen('screen-home');
    updateHUD();
}

function renderLeague() {
    let html = "";
    state.league.forEach((t, i) => {
        let style = t.name === "Bƒ∞Zƒ∞M TAKIM" ? "color:var(--accent); font-weight:bold;" : "";
        html += `<div class="table-row" style="${style}">
            <span>${i+1}. ${t.name}</span>
            <span>${t.p} P</span>
        </div>`;
    });
    document.getElementById('league-table').innerHTML = html;
}

function trainPlayer() {
    if(state.energy >= 15) {
        state.energy -= 15;
        state.skill++;
        state.relationships.boss += 2; // Hoca √ßalƒ±≈üanƒ± sever
        alert("Antrenman bitti! ≈ûut yeteneƒüin arttƒ±.");
        updateHUD();
    } else {
        alert("√áok yorgunsun!");
    }
}

function renderShop() {
    let html = "";
    shopItems.forEach(item => {
        // Envanterde var mƒ±?
        let owned = state.inventory.includes(item.id);
        let btnText = owned ? "SATIN ALINDI" : `SATIN AL ($${item.cost})`;
        let btnClass = owned ? "background:#555;" : "background:var(--primary);";
        let onclick = owned ? "" : `buyItem('${item.id}')`;

        html += `
        <div style="background:#333; padding:10px; margin-bottom:10px; border-radius:5px; display:flex; justify-content:space-between; align-items:center;">
            <div style="font-size:24px;">${item.icon}</div>
            <div style="flex:1; margin-left:10px;">
                <div style="font-weight:bold; color:var(--accent)">${item.name}</div>
                <div style="font-size:10px; opacity:0.7">${item.id === 'nrg' ? '+Enerji' : 'Prestij/Yetenek'}</div>
            </div>
            <button style="border:none; padding:8px; color:white; border-radius:4px; ${btnClass}" onclick="${onclick}">${btnText}</button>
        </div>`;
    });
    document.getElementById('shop-items').innerHTML = html;
}

window.buyItem = function(id) {
    let item = shopItems.find(i => i.id === id);
    if(state.money >= item.cost) {
        state.money -= item.cost;
        
        if(item.effect === 'energy') {
            state.energy = 100;
        } else if (item.effect === 'boots') {
            state.bootsMultiplier = 1.5;
            state.inventory.push(id);
        } else if (item.effect === 'star') {
            state.rating += item.val;
            state.inventory.push(id);
        } else if (item.effect === 'rel') {
            state.relationships[item.target] += item.val;
            if(item.id !== 'gift') state.inventory.push(id); // Hediyeler kalƒ±cƒ± deƒüil
        }
        
        alert(item.name + " satƒ±n alƒ±ndƒ±!");
        updateHUD();
        renderShop();
    } else {
        alert("Yetersiz Bakiye!");
    }
}

</script>
</body>
</html>
